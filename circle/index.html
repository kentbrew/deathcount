<html>
  <head>
    <meta charset="utf-8">
    <title>Trump's Circle of Death</title>
    <link rel="canonical" href="https://deathcount.us/circle/" />
    <link rel="shortcut icon" href="favicon.gif" type="image/gif" />
    <link rel="apple-touch-icon" href="ios.jpg" />
    <meta name="apple-mobile-web-app-title" content="deathcount" />
    <meta name="author" content="Kent Brewster" />
    <meta name="description" content="If you laid every American who died from COVID-19 in a circle around Trump Tower, this is how big it would be." />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:creator" content="@kentbrew" />
    <meta property="twitter:title" content="Trump's Circle of Death" />
    <meta property="twitter:description" content="If you laid every American who died from COVID-19 in a circle around Trump Tower, this is how big it would be." />
    <meta name="twitter:image" content="https://deathcount.us/circle/twitter.jpg" />
    <meta property="og:url" content="http://deathcount.us/circle/" />
    <meta property="og:title" content="Trump's Circle of Death" />
    <meta property="og:description" content="If you laid every American who died from COVID-19 in a circle around Trump Tower, this is how big it would be." />
    <meta property="og:image" content="https://deathcount.us/circle/og.jpg" />
    <meta property="og:type" content="website" />
    <style>
      body {
        background: #000;
        color: #fff;
        font-family: Tahoma, "Helvetica Neue", Sans-serif;
        margin: 2vw 2vh;
        text-align: center;
      }
      a {
        color: #ff0;
        text-decoration: none;
      }
      span.bignum {
        display: block;
        font-size: 16vw;
      }
      div.tile {
        display: inline-block;
        height: 440px;
        margin: 20px 10px 10px;
        width: 420px;
      }
      div.map {
        background: transparent url() 0 0 no-repeat;
        border-radius: 10px;
        height: 400px;
        margin: 10px;
        position: relative;
        width: 400px;
      }
      div.map span {
        color: #000;
        font-size: 100px;
        font-family: "Times New Roman", serif;
        height: 100px;
        left: 50%;
        line-height: 100px;
        margin-top: -50px;
        margin-left: -50px;
        position: absolute;
        top: 50%;
        width: 100px;
      }
      #ft {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Trump's Circle of Death</h1>
    <div id="hd"></div>
    <div id="bd"></div>
    <p id="ct"></p>
    <p>Had enough? Check with <a href="https://vote.org" target="_blank">Vote.org</a> to be sure your voice is heard.</p>
    <div id="ft">
      <a href="https://github.com/kentbrew/deathcount/blob/master/README.md" target="_blank">About</a> - 
      <a href="https://www.coronatracker.com/country/united-states/" target="_blank">Data</a> - 
      <a href="https://twitter.com/kentbrew" target="_blank">Contact</a> - 
      <a href="https://neocities.org" target="_blank">Hosting</a>
    </div>
    <script>
      // in case we don't get data
      const mostRecent = {
        date: "30 Aug 2020",
        dead: 186883
      },
      // 
      bounds = [75000, 150000, 300000, 600000, 1200000, 2400000, 4800000],
      hd = document.getElementById('hd'),
      bd = document.getElementById('bd'),
      ct = document.getElementById('ct'),
      // a list of properties for which we're going to draw a map. Each needs a name, latitude, and a map ID
      // maps will appear on the page in the order they appear in this array
      properties = [ {
          name: "Trump Tower, Manhattan",
          lat: 40.762315,
          map: 4
        }, {
          name: "Trump International Hotel, Washington DC",
          lat: 38.8942404,
          map: 2
        }, {
          name: "Trump International Hotel, Las Vegas",
          lat: 36.127671,
          map: 1
        }, {
          name: "Trump National Golf Club, Bedminster",
          lat: 40.653755,
          map: 3
        }, {
          name: "Trump International Hotel & Tower, Chicago",
          lat: 41.8888012,
          map: 5
        }, {
          name: "Mar-a-Lago",
          lat: 26.677084,
          map: 0
        }
      ],
      // Format a long number with commas, US-style
      formatNumber = n => {
        return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      },
      // get a zoom level based on the number of dead that will make a cirlc
      getZoomLevel = dead => {
        let zoomLevel = 0;
        bounds.filter((item, index) => {
          if (item < dead) {
            zoomLevel = index + 1;
          }
        });
        return zoomLevel;
      },
      // get meters per pixel at a zoom level and latitude
      getMetersPerPixel = (zoomLevel, latitude) => {
        return 40075016.686 * Math.abs(Math.cos(latitude * Math.PI/180)) / Math.pow(2, zoomLevel + 8);
      },
      // get zoom level and circle radius
      getZoomAndRadiusFor = (dead, latitude) => {
        let zoomLevel = getZoomLevel(dead);
        let metersPerPixel = getMetersPerPixel(10 - zoomLevel, latitude);
        let circInFeet = dead * 6;
        let radiusInMeters = (circInFeet * 0.3048 / 2 / Math.PI);
        let radiusInPixels = radiusInMeters / metersPerPixel;
        return { 
          zoomLevel: zoomLevel,
          radius: radiusInPixels,
          circInMiles: Math.floor(circInFeet / 5280)
        };
      },
      // make a map
      makeMap = (x, y, name) => {
        // create the container
        const tile = document.createElement('DIV');
        tile.className = "tile";
        const map = document.createElement('DIV');
        map.className = "map";
        map.innerHTML = "<span>T</span>";
        map.style.backgroundImage = `url("./zoom_${x}.jpg")`;
        map.style.backgroundPositionY = `${(0 - y) * 400}px`;
        tile.appendChild(map);
        const p = document.createElement('P');
        p.innerHTML = name;
        tile.appendChild(p);
        return tile;
      },
      // make a circle
      makeCircle = (radius) => {
        let canvas = document.createElement('CANVAS');
        canvas.height = 400;
        canvas.width = 400;
        let ctx = canvas.getContext("2d");
        ctx.lineWidth = 5;
        ctx.beginPath();
        ctx.strokeStyle = "#FF0000";
        ctx.setLineDash([15, 5]);
        ctx.arc(200, 200, radius, 0, Math.PI * 2, true);
        ctx.stroke();
        return canvas;
      },
      // return days, hours, minutes, and second until an event
      howLong = when => {
        // expects a parse-able string like "Nov 3, 2020" or "Nov 3, 2020 12:34:56"
        const dMs = new Date(when).getTime() - Date.now(), 
        dS = ~~(dMs / 1000),
        dM = ~~(dS / 60),
        dH = ~~(dM / 60),
        dD = ~~(dH / 24);
        return {
          days: dD,
          hours: dH % (dD * 24),
          minutes: dM % (dH * 60),
          seconds: dS % (dM * 60)
        };
      },
      // add "s" to noun when needed
      getPlural = (noun, count) => {
        let suffix = "";
        if (count !== 1) {
          suffix = "s";
        }
        return `${count} ${noun}${suffix}`;
      },
      // update the counter
      updateCounter = () => {
        until = howLong("Nov 3, 2020");
        ct.innerHTML = `${getPlural("day", until.days)},
          ${getPlural("hour", until.hours)},
          ${getPlural("minute", until.minutes)},
          and ${getPlural("second", until.seconds)}
          remain until the next election, 3 November 2020.</p>`;
        window.setTimeout(updateCounter, 1000);
      },
      // render maps 
      render = dead => {
        let circ = "";
        properties.filter((prop) => {
          let zar = getZoomAndRadiusFor(dead, prop.lat);
          let tile = makeMap(zar.zoomLevel, prop.map, prop.name);
          circ = zar.circInMiles;
          tile.getElementsByClassName('map')[0].appendChild(makeCircle(zar.radius));
          bd.appendChild(tile);
        });
        hd.innerHTML += `<p><span class="bignum">${formatNumber(dead)}</span> Americans <a href="https://www.coronatracker.com/country/united-states/" target="_blank">have died of COVID-19</a> on Donald Trump's watch so far.</p>
          <p>If you laid them out head to toe, they would make a circle ${circ} miles around.</p>
          <p>Here's what that ${circ}-mile circle would look like around some Trump properties.</p>`;
        updateCounter();
      },
      // let's get this party started
      init = () => {
        // Fetch the data
        fetch('https://api.coronatracker.com/v3/stats/worldometer/country?countryCode=US')
          // Massage the result
          .then(response => response.json())
          // Hand it off for processing
          .then(result => {
            let found = false;
            if (result[0] && result[0].totalDeaths) {
              render(result[0].totalDeaths);
              found = true;
            }
            return found;
          }).then(found => {
            if (!found) {
              hd.innerHTML = "<p>Having trouble getting data, so here's what we saw on " + mostRecent.date + ".</p>";
              render(mostRecent.dead);
            }
          }).catch(error => {
            console.log(error);
            render(mostRecent.dead)
          });
      };
        
      // kick it off
      init();
      
    </script>
  </body>
</html>
